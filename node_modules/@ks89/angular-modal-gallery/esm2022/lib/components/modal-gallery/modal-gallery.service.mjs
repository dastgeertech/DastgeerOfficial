import { EventEmitter, Injectable } from '@angular/core';
import { OverlayConfig } from '@angular/cdk/overlay';
import { Subject } from 'rxjs';
import { ModalGalleryRef } from './modal-gallery-ref';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/overlay";
import * as i2 from "../../services/config.service";
const DEFAULT_DIALOG_CONFIG = {
    hasBackdrop: true,
    backdropClass: 'ks-modal-gallery-backdrop',
    panelClass: 'ks-modal-gallery-panel'
};
export class ModalGalleryService {
    constructor(overlay, configService) {
        this.overlay = overlay;
        this.configService = configService;
        this.updateImages = new Subject();
        this.updateImages$ = this.updateImages.asObservable();
        this.triggerAttachToOverlay = new EventEmitter();
    }
    /**
     * Method to open modal gallery passing the configuration
     * @param config ModalGalleryConfig that contains: id, array of images, current image and optionally the configuration object
     * @return ModalGalleryRef | undefined is the object used to listen for events.
     */
    open(config) {
        // Returns an OverlayRef which is a PortalHost
        const overlayRef = this.createOverlay();
        // Instantiate a reference to the dialog
        this.dialogRef = new ModalGalleryRef(overlayRef);
        // Attach dialog container
        this.triggerAttachToOverlay.emit({
            overlayRef,
            config,
            dialogRef: this.dialogRef
        });
        overlayRef.backdropClick().subscribe(() => {
            if (this.dialogRef) {
                this.dialogRef.closeModal();
            }
        });
        return this.dialogRef;
    }
    /**
     * Method to close a modal gallery previously opened.
     * @param id Unique identifier of the modal gallery
     * @param clickOutside boolean is true if closed clicking on the modal backdrop, false otherwise.
     */
    close(id, clickOutside) {
        const libConfig = this.configService.getConfig(id);
        if (clickOutside) {
            if (this.dialogRef && libConfig && libConfig.enableCloseOutside) {
                this.dialogRef.closeModal();
            }
        }
        else {
            if (this.dialogRef) {
                this.dialogRef.closeModal();
            }
        }
    }
    /**
     * Method to update images array.
     * @param images Image[] updated array of images
     */
    updateModalImages(images) {
        this.updateImages.next(images);
    }
    /**
     * Method to emit close event.
     * @param event ImageModalEvent is the event payload
     */
    emitClose(event) {
        if (!this.dialogRef) {
            return;
        }
        this.dialogRef.emitClose(event);
    }
    /**
     * Method to emit show event.
     * @param event ImageModalEvent is the event payload
     */
    emitShow(event) {
        if (!this.dialogRef) {
            return;
        }
        this.dialogRef.emitShow(event);
    }
    /**
     * Method to emit firstImage event.
     * @param event ImageModalEvent is the event payload
     */
    emitFirstImage(event) {
        if (!this.dialogRef) {
            return;
        }
        this.dialogRef.emitFirstImage(event);
    }
    /**
     * Method to emit lastImage event.
     * @param event ImageModalEvent is the event payload
     */
    emitLastImage(event) {
        if (!this.dialogRef) {
            return;
        }
        this.dialogRef.emitLastImage(event);
    }
    /**
     * Method to emit hasData event.
     * @param event ImageModalEvent is the event payload
     */
    emitHasData(event) {
        if (!this.dialogRef) {
            return;
        }
        this.dialogRef.emitHasData(event);
    }
    /**
     * Method to emit buttonBeforeHook event.
     * @param event ButtonEvent is the event payload
     */
    emitButtonBeforeHook(event) {
        if (!this.dialogRef) {
            return;
        }
        this.dialogRef.emitButtonBeforeHook(event);
    }
    /**
     * Method to emit buttonAfterHook event.
     * @param event ButtonEvent is the event payload
     */
    emitButtonAfterHook(event) {
        if (!this.dialogRef) {
            return;
        }
        this.dialogRef.emitButtonAfterHook(event);
    }
    /**
     * Private method to create an Overlay using Angular CDK APIs
     * @private
     */
    createOverlay() {
        const overlayConfig = this.getOverlayConfig();
        return this.overlay.create(overlayConfig);
    }
    /**
     * Private method to create an OverlayConfig instance
     * @private
     */
    getOverlayConfig() {
        const positionStrategy = this.overlay.position().global().centerHorizontally().centerVertically();
        return new OverlayConfig({
            hasBackdrop: DEFAULT_DIALOG_CONFIG.hasBackdrop,
            backdropClass: DEFAULT_DIALOG_CONFIG.backdropClass,
            panelClass: DEFAULT_DIALOG_CONFIG.panelClass,
            scrollStrategy: this.overlay.scrollStrategies.block(),
            positionStrategy
        });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.0.5", ngImport: i0, type: ModalGalleryService, deps: [{ token: i1.Overlay }, { token: i2.ConfigService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.0.5", ngImport: i0, type: ModalGalleryService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.0.5", ngImport: i0, type: ModalGalleryService, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }], ctorParameters: () => [{ type: i1.Overlay }, { type: i2.ConfigService }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwtZ2FsbGVyeS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMva3M4OS9hbmd1bGFyLW1vZGFsLWdhbGxlcnkvc3JjL2xpYi9jb21wb25lbnRzL21vZGFsLWdhbGxlcnkvbW9kYWwtZ2FsbGVyeS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBbUMsYUFBYSxFQUFjLE1BQU0sc0JBQXNCLENBQUM7QUFDbEcsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQixPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7QUFrQ3RELE1BQU0scUJBQXFCLEdBQXNCO0lBQy9DLFdBQVcsRUFBRSxJQUFJO0lBQ2pCLGFBQWEsRUFBRSwyQkFBMkI7SUFDMUMsVUFBVSxFQUFFLHdCQUF3QjtDQUNyQyxDQUFDO0FBR0YsTUFBTSxPQUFPLG1CQUFtQjtJQVE5QixZQUFvQixPQUFnQixFQUFVLGFBQTRCO1FBQXRELFlBQU8sR0FBUCxPQUFPLENBQVM7UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQVBsRSxpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFXLENBQUM7UUFDOUMsa0JBQWEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBSTFDLDJCQUFzQixHQUFHLElBQUksWUFBWSxFQUEwQixDQUFDO0lBRzNFLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsSUFBSSxDQUFDLE1BQTBCO1FBQzdCLDhDQUE4QztRQUM5QyxNQUFNLFVBQVUsR0FBZSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDcEQsd0NBQXdDO1FBQ3hDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxlQUFlLENBQUMsVUFBVSxDQUFDLENB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YUFBYTtRQUNuQixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUM5QyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRDs7O09BR0c7SUFDSyxnQkFBZ0I7UUFDdEIsTUFBTSxnQkFBZ0IsR0FBMkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDMUgsT0FBTyxJQUFJLGFBQWEsQ0FBQztZQUN2QixXQUFXLEVBQUUscUJBQXFCLENBQUMsV0FBVztZQUM5QyxhQUFhLEVBQUUscUJBQXFCLENBQUMsYUFBYTtZQUNsRCxVQUFVLEVBQUUscUJBQXFCLENBQUMsVUFBVTtZQUM1QyxjQUFjLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUU7WUFDckQsZ0JBQWdCO1NBQ2pCLENBQUMsQ0FBQztJQUNMLENBQUM7OEdBaEtVLG1CQUFtQjtrSEFBbkIsbUJBQW1CLGNBRFAsTUFBTTs7MkZBQ2xCLG1CQUFtQjtrQkFEL0IsVUFBVTttQkFBQyxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEdsb2JhbFBvc2l0aW9uU3RyYXRlZ3ksIE92ZXJsYXksIE92ZXJsYXlDb25maWcsIE92ZXJsYXlSZWYgfSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IE1vZGFsR2FsbGVyeVJlZiB9IGZyb20gJy4vbW9kYWwtZ2FsbGVyeS1yZWYnO1xuaW1wb3J0IHsgSW1hZ2UsIEltYWdlTW9kYWxFdmVudCB9IGZyb20gJy4uLy4uL21vZGVsL2ltYWdlLmNsYXNzJztcbmltcG9ydCB7IENvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9jb25maWcuc2VydmljZSc7XG5pbXBvcnQgeyBCdXR0b25FdmVudCB9IGZyb20gJy4uLy4uL21vZGVsL2J1dHRvbnMtY29uZmlnLmludGVyZmFjZSc7XG5pbXBvcnQgeyBNb2RhbEdhbGxlcnlDb25maWcgfSBmcm9tICcuLi8uLi9tb2RlbC9tb2RhbC1nYWxsZXJ5LWNvbmZpZy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgTGliQ29uZmlnIH0gZnJvbSAnLi4vLi4vbW9kZWwvbGliLWNvbmZpZy5pbnRlcmZhY2UnO1xuXG4vLyBwcml2YXRlIGludGVyZmFjZSB1c2VkIG9ubHkgaW4gdGhpcyBmaWxlXG5pbnRlcmZhY2UgTW9kYWxEaWFsb2dDb25maWcge1xuICBwYW5lbENsYXNzOiBzdHJpbmc7XG4gIGhhc0JhY2tkcm9wOiBib29sZWFuO1xuICBiYWNrZHJvcENsYXNzOiBzdHJpbmc7XG59XG5cbi8qKlxuICogUGF5bG9hZCB0byBiZSBlbWl0dGVkIHZpYSB7QGxpbmsgdHJpZ2dlckF0dGFjaFRvT3ZlcmxheX0gdG8gZW5hYmxlIHtAbGluayBBdHRhY2hUb092ZXJsYXlTZXJ2aWNlfVxuICogdG8gYXR0YWNoIHRoZSB7QGxpbmsgTW9kYWxHYWxsZXJ5Q29tcG9uZW50fSB0byB0aGUgb3ZlcmxheVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEF0dGFjaFRvT3ZlcmxheVBheWxvYWQge1xuICAvKipcbiAgICogT3ZlcmxheSBvYmplY3QgY3JlYXRlZCB1c2luZyBBbmd1bGFyIENESyBBUElzXG4gICAqL1xuICBvdmVybGF5UmVmOiBPdmVybGF5UmVmO1xuICAvKipcbiAgICogRGlhbG9nIGRhdGEgdG8gYmUgaW5qZWN0ZWQgaW50byB0aGUge0BsaW5rIE1vZGFsR2FsbGVyeUNvbXBvbmVudH1cbiAgICogY29udGFpbnM6IGlkLCBhcnJheSBvZiBpbWFnZXMsIGN1cnJlbnQgaW1hZ2UgYW5kIG9wdGlvbmFsbHkgdGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0XG4gICAqL1xuICBjb25maWc6IE1vZGFsR2FsbGVyeUNvbmZpZztcbiAgLyoqXG4gICAqIE9iamVjdCB0byBjb250cm9sIHRoZSBkaWFsb2cgaW5zdGFuY2VcbiAgICovXG4gIGRpYWxvZ1JlZjogTW9kYWxHYWxsZXJ5UmVmO1xufVxuXG5jb25zdCBERUZBVUxUX0RJQUxPR19DT05GSUc6IE1vZGFsRGlhbG9nQ29uZmlnID0ge1xuICBoYXNCYWNrZHJvcDogdHJ1ZSxcbiAgYmFja2Ryb3BDbGFzczogJ2tzLW1vZGFsLWdhbGxlcnktYmFja2Ryb3AnLFxuICBwYW5lbENsYXNzOiAna3MtbW9kYWwtZ2FsbGVyeS1wYW5lbCdcbn07XG5cbkBJbmplY3RhYmxlKHtwcm92aWRlZEluOiAncm9vdCd9KVxuZXhwb3J0IGNsYXNzIE1vZGFsR2FsbGVyeVNlcnZpY2Uge1xuICBwcml2YXRlIHVwZGF0ZUltYWdlcyA9IG5ldyBTdWJqZWN0PEltYWdlW10+KCk7XG4gIHVwZGF0ZUltYWdlcyQgPSB0aGlzLnVwZGF0ZUltYWdlcy5hc09ic2VydmFibGUoKTtcblxuICBwcml2YXRlIGRpYWxvZ1JlZjogTW9kYWxHYWxsZXJ5UmVmIHwgdW5kZWZpbmVkO1xuXG4gIHB1YmxpYyB0cmlnZ2VyQXR0YWNoVG9PdmVybGF5ID0gbmV3IEV2ZW50RW1pdHRlcjxBdHRhY2hUb092ZXJsYXlQYXlsb2FkPigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgb3ZlcmxheTogT3ZlcmxheSwgcHJpdmF0ZSBjb25maWdTZXJ2aWNlOiBDb25maWdTZXJ2aWNlKSB7XG4gIH1cblxuICAvKipcbiAgICogTWV0aG9kIHRvIG9wZW4gbW9kYWwgZ2FsbGVyeSBwYXNzaW5nIHRoZSBjb25maWd1cmF0aW9uXG4gICAqIEBwYXJhbSBjb25maWcgTW9kYWxHYWxsZXJ5Q29uZmlnIHRoYXQgY29udGFpbnM6IGlkLCBhcnJheSBvZiBpbWFnZXMsIGN1cnJlbnQgaW1hZ2UgYW5kIG9wdGlvbmFsbHkgdGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0XG4gICAqIEByZXR1cm4gTW9kYWxHYWxsZXJ5UmVmIHwgdW5kZWZpbmVkIGlzIHRoZSBvYmplY3QgdXNlZCB0byBsaXN0ZW4gZm9yIGV2ZW50cy5cbiAgICovXG4gIG9wZW4oY29uZmlnOiBNb2RhbEdhbGxlcnlDb25maWcpOiBNb2RhbEdhbGxlcnlSZWYgfCB1bmRlZmluZWQge1xuICAgIC8vIFJldHVybnMgYW4gT3ZlcmxheVJlZiB3aGljaCBpcyBhIFBvcnRhbEhvc3RcbiAgICBjb25zdCBvdmVybGF5UmVmOiBPdmVybGF5UmVmID0gdGhpcy5jcmVhdGVPdmVybGF5KCk7XG4gICAgLy8gSW5zdGFudGlhdGUgYSByZWZlcmVuY2UgdG8gdGhlIGRpYWxvZ1xuICAgIHRoaXMuZGlhbG9nUmVmID0gbmV3IE1vZGFsR2FsbGVyeVJlZihvdmVybGF5UmVmKTtcbiAgICAvLyBBdHRhY2ggZGlhbG9nIGNvbnRhaW5lclxuICAgIHRoaXMudHJpZ2dlckF0dGFjaFRvT3ZlcmxheS5lbWl0KHtcbiAgICAgIG92ZXJsYXlSZWYsXG4gICAgICBjb25maWcsXG4gICAgICBkaWFsb2dSZWY6IHRoaXMuZGlhbG9nUmVmXG4gICAgfSk7XG4gICAgb3ZlcmxheVJlZi5iYWNrZHJvcENsaWNrKCkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmRpYWxvZ1JlZikge1xuICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZU1vZGFsKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuZGlhbG9nUmVmO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ldGhvZCB0byBjbG9zZSBhIG1vZGFsIGdhbGxlcnkgcHJldmlvdXNseSBvcGVuZWQuXG4gICAqIEBwYXJhbSBpZCBVbmlxdWUgaWRlbnRpZmllciBvZiB0aGUgbW9kYWwgZ2FsbGVyeVxuICAgKiBAcGFyYW0gY2xpY2tPdXRzaWRlIGJvb2xlYW4gaXMgdHJ1ZSBpZiBjbG9zZWQgY2xpY2tpbmcgb24gdGhlIG1vZGFsIGJhY2tkcm9wLCBmYWxzZSBvdGhlcndpc2UuXG4gICAqL1xuICBjbG9zZShpZDogbnVtYmVyLCBjbGlja091dHNpZGU6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBjb25zdCBsaWJDb25maWc6IExpYkNvbmZpZyB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlnU2VydmljZS5nZXRDb25maWcoaWQpO1xuICAgIGlmIChjbGlja091dHNpZGUpIHtcbiAgICAgIGlmICh0aGlzLmRpYWxvZ1JlZiAmJiBsaWJDb25maWcgJiYgbGliQ29uZmlnLmVuYWJsZUNsb3NlT3V0c2lkZSkge1xuICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZU1vZGFsKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmRpYWxvZ1JlZikge1xuICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZU1vZGFsKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1ldGhvZCB0byB1cGRhdGUgaW1hZ2VzIGFycmF5LlxuICAgKiBAcGFyYW0gaW1hZ2VzIEltYWdlW10gdXBkYXRlZCBhcnJheSBvZiBpbWFnZXNcbiAgICovXG4gIHVwZGF0ZU1vZGFsSW1hZ2VzKGltYWdlczogSW1hZ2VbXSk6IHZvaWQge1xuICAgIHRoaXMudXBkYXRlSW1hZ2VzLm5leHQoaW1hZ2VzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNZXRob2QgdG8gZW1pdCBjbG9zZSBldmVudC5cbiAgICogQHBhcmFtIGV2ZW50IEltYWdlTW9kYWxFdmVudCBpcyB0aGUgZXZlbnQgcGF5bG9hZFxuICAgKi9cbiAgZW1pdENsb3NlKGV2ZW50OiBJbWFnZU1vZGFsRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZGlhbG9nUmVmKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZGlhbG9nUmVmLmVtaXRDbG9zZShldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogTWV0aG9kIHRvIGVtaXQgc2hvdyBldmVudC5cbiAgICogQHBhcmFtIGV2ZW50IEltYWdlTW9kYWxFdmVudCBpcyB0aGUgZXZlbnQgcGF5bG9hZFxuICAgKi9cbiAgZW1pdFNob3coZXZlbnQ6IEltYWdlTW9kYWxFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5kaWFsb2dSZWYpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5kaWFsb2dSZWYuZW1pdFNob3coZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ldGhvZCB0byBlbWl0IGZpcnN0SW1hZ2UgZXZlbnQuXG4gICAqIEBwYXJhbSBldmVudCBJbWFnZU1vZGFsRXZlbnQgaXMgdGhlIGV2ZW50IHBheWxvYWRcbiAgICovXG4gIGVtaXRGaXJzdEltYWdlKGV2ZW50OiBJbWFnZU1vZGFsRXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuZGlhbG9nUmVmKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZGlhbG9nUmVmLmVtaXRGaXJzdEltYWdlKGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNZXRob2QgdG8gZW1pdCBsYXN0SW1hZ2UgZXZlbnQuXG4gICAqIEBwYXJhbSBldmVudCBJbWFnZU1vZGFsRXZlbnQgaXMgdGhlIGV2ZW50IHBheWxvYWRcbiAgICovXG4gIGVtaXRMYXN0SW1hZ2UoZXZlbnQ6IEltYWdlTW9kYWxFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5kaWFsb2dSZWYpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5kaWFsb2dSZWYuZW1pdExhc3RJbWFnZShldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogTWV0aG9kIHRvIGVtaXQgaGFzRGF0YSBldmVudC5cbiAgICogQHBhcmFtIGV2ZW50IEltYWdlTW9kYWxFdmVudCBpcyB0aGUgZXZlbnQgcGF5bG9hZFxuICAgKi9cbiAgZW1pdEhhc0RhdGEoZXZlbnQ6IEltYWdlTW9kYWxFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5kaWFsb2dSZWYpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5kaWFsb2dSZWYuZW1pdEhhc0RhdGEoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIE1ldGhvZCB0byBlbWl0IGJ1dHRvbkJlZm9yZUhvb2sgZXZlbnQuXG4gICAqIEBwYXJhbSBldmVudCBCdXR0b25FdmVudCBpcyB0aGUgZXZlbnQgcGF5bG9hZFxuICAgKi9cbiAgZW1pdEJ1dHRvbkJlZm9yZUhvb2soZXZlbnQ6IEJ1dHRvbkV2ZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmRpYWxvZ1JlZikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmRpYWxvZ1JlZi5lbWl0QnV0dG9uQmVmb3JlSG9vayhldmVudCk7XG4gIH1cblxuICAvKipcbiAgICogTWV0aG9kIHRvIGVtaXQgYnV0dG9uQWZ0ZXJIb29rIGV2ZW50LlxuICAgKiBAcGFyYW0gZXZlbnQgQnV0dG9uRXZlbnQgaXMgdGhlIGV2ZW50IHBheWxvYWRcbiAgICovXG4gIGVtaXRCdXR0b25BZnRlckhvb2soZXZlbnQ6IEJ1dHRvbkV2ZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmRpYWxvZ1JlZikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmRpYWxvZ1JlZi5lbWl0QnV0dG9uQWZ0ZXJIb29rKGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIG1ldGhvZCB0byBjcmVhdGUgYW4gT3ZlcmxheSB1c2luZyBBbmd1bGFyIENESyBBUElzXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZU92ZXJsYXkoKTogT3ZlcmxheVJlZiB7XG4gICAgY29uc3Qgb3ZlcmxheUNvbmZpZyA9IHRoaXMuZ2V0T3ZlcmxheUNvbmZpZygpO1xuICAgIHJldHVybiB0aGlzLm92ZXJsYXkuY3JlYXRlKG92ZXJsYXlDb25maWcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgbWV0aG9kIHRvIGNyZWF0ZSBhbiBPdmVybGF5Q29uZmlnIGluc3RhbmNlXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIGdldE92ZXJsYXlDb25maWcoKTogT3ZlcmxheUNvbmZpZyB7XG4gICAgY29uc3QgcG9zaXRpb25TdHJhdGVneTogR2xvYmFsUG9zaXRpb25TdHJhdGVneSA9IHRoaXMub3ZlcmxheS5wb3NpdGlvbigpLmdsb2JhbCgpLmNlbnRlckhvcml6b250YWxseSgpLmNlbnRlclZlcnRpY2FsbHkoKTtcbiAgICByZXR1cm4gbmV3IE92ZXJsYXlDb25maWcoe1xuICAgICAgaGFzQmFja2Ryb3A6IERFRkFVTFRfRElBTE9HX0NPTkZJRy5oYXNCYWNrZHJvcCxcbiAgICAgIGJhY2tkcm9wQ2xhc3M6IERFRkFVTFRfRElBTE9HX0NPTkZJRy5iYWNrZHJvcENsYXNzLFxuICAgICAgcGFuZWxDbGFzczogREVGQVVMVF9ESUFMT0dfQ09ORklHLnBhbmVsQ2xhc3MsXG4gICAgICBzY3JvbGxTdHJhdGVneTogdGhpcy5vdmVybGF5LnNjcm9sbFN0cmF0ZWdpZXMuYmxvY2soKSxcbiAgICAgIHBvc2l0aW9uU3RyYXRlZ3lcbiAgICB9KTtcbiAgfVxufVxuIl19